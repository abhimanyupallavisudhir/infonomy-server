# BotSeller Implementation

This document describes the new BotSeller functionality implemented in the Infonomy information market server.

## Overview

BotSellers are automated information providers that can either:
1. **Fixed Info Bots**: Provide predetermined information at a set price when their matchers trigger
2. **LLM Bots**: Use an LLM to dynamically generate information based on the DecisionContext

## Key Features

### 1. BotSeller CRUD Operations
- **POST** `/bot-sellers/` - Create a new BotSeller
- **GET** `/bot-sellers/` - List all BotSellers for the current user
- **GET** `/bot-sellers/{id}` - Get a specific BotSeller
- **PUT** `/bot-sellers/{id}` - Update a BotSeller
- **DELETE** `/bot-sellers/{id}` - Delete a BotSeller

### 2. Matcher Management
- **POST** `/bot-sellers/{id}/matchers` - Create a matcher for a BotSeller
- **GET** `/bot-sellers/{id}/matchers` - List all matchers for a BotSeller
- **PUT** `/bot-sellers/{id}/matchers/{matcher_id}` - Update a matcher
- **DELETE** `/bot-sellers/{id}/matchers/{matcher_id}` - Delete a matcher

### 3. Automatic Processing
- BotSellers are automatically processed when DecisionContexts are submitted to seller inboxes
- Fixed info bots immediately provide their predetermined information
- LLM bots generate information using their configured model and prompt
- All BotSeller responses are processed server-side for immediate availability

## Usage Examples

### Creating a Fixed Info Bot
```json
POST /bot-sellers/
{
  "info": "The answer to life, the universe, and everything is 42.",
  "llm_model": null,
  "llm_prompt": null
}
```

### Creating an LLM Bot
```json
POST /bot-sellers/
{
  "info": null,
  "llm_model": "gpt-4",
  "llm_prompt": "You are a helpful AI assistant. Provide concise, accurate information based on the user's query."
}
```

### Adding a Matcher
```json
POST /bot-sellers/{id}/matchers
{
  "keywords": ["philosophy", "meaning", "life"],
  "context_pages": null,
  "min_max_budget": 0.0,
  "min_inspection_rate": 0.0,
  "min_purchase_rate": 0.0,
  "min_priority": 0,
  "buyer_type": "human_buyer",
  "buyer_llm_model": null,
  "buyer_system_prompt": null,
  "age_limit": 86400
}
```

## Technical Implementation

### 1. Models
- `BotSeller`: Stores bot configuration (fixed info or LLM settings)
- `SellerMatcher`: Defines when and how bots should respond
- `InfoOffer`: Generated by bots when their matchers trigger

### 2. Tasks
- `process_bot_sellers_for_context`: Celery task that processes all matching BotSellers
- `inspect_task`: Updated to use time-based timeout (30 seconds) instead of count-based

### 3. Integration
- BotSellers are automatically included in the `recompute_inbox_for_context` function
- DecisionContexts are sent to all sellers including BotSellers
- BotSeller processing is triggered immediately when contexts are submitted

## Configuration

### Timeout Settings
- BotSeller response timeout: 30 seconds (configurable in `tasks.py`)
- Polling interval: 2 seconds (reduced from 5 seconds for faster response)

### LLM Integration
- Supports any model compatible with the `completion` function
- Configurable prompts for customizing bot behavior
- Error handling for failed LLM calls

## Security and Authorization

- Users can only create/modify BotSellers if they have a seller profile
- BotSellers are isolated per user
- All operations require authentication via `current_active_user`

## Future Enhancements

1. **Pricing**: Allow BotSellers to set custom prices for their information
2. **Rate Limiting**: Implement rate limiting for LLM-based BotSellers
3. **Caching**: Cache LLM responses for similar queries
4. **Analytics**: Track BotSeller performance and usage metrics
5. **Webhooks**: Allow external systems to trigger BotSeller responses 