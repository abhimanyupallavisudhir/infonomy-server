{% extends "base.html" %}

{% block title %}Home - Information Market Platform{% endblock %}

{% block content %}
<div class="container">
    <h1 class="page-title">Information Market Platform</h1>
    
    <div id="auth-content">
        <!-- This will be populated by JavaScript based on auth status -->
    </div>
    
    <div class="recent-questions">
        <h2>Recent Questions</h2>
        {% if questions %}
            <div class="questions-list">
                {% for question in questions %}
                    <div class="question-card">
                        <div class="question-header">
                            <h3><a href="/questions/{{ question.id }}">{{ question.query or "No title" }}</a></h3>
                            <span class="question-meta">
                                Budget: ${{ "%.2f"|format(question.max_budget) }} | 
                                Priority: {{ question.priority }} | 
                                {{ question.created_at.strftime('%Y-%m-%d %H:%M') }}
                            </span>
                        </div>
                        {% if question.context_pages %}
                            <div class="context-pages">
                                <strong>Context:</strong> {{ question.context_pages|join(', ') }}
                            </div>
                        {% endif %}
                        <div class="question-footer">
                            <a href="/questions/{{ question.id }}" class="btn btn-secondary">View Details</a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>No questions yet. Be the first to ask!</p>
        {% endif %}
    </div>
</div>

<script>
// Update auth content based on login status
function updateAuthContent() {
    const authContent = document.getElementById('auth-content');
    const token = getCookie('auth_token');
    
    if (token) {
        // User is logged in
        authContent.innerHTML = `
            <div class="new-question-form">
                <h2>Ask a New Question</h2>
                <form method="post" action="/questions">
                    <div class="form-group">
                        <label for="query">Question:</label>
                        <textarea name="query" id="query" rows="3" placeholder="What information do you need?" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="context_pages">Context Pages (comma-separated):</label>
                        <input type="text" name="context_pages" id="context_pages" placeholder="page1, page2, page3">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="max_budget">Maximum Budget:</label>
                            <input type="number" name="max_budget" id="max_budget" step="0.01" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="priority">Priority:</label>
                            <select name="priority" id="priority">
                                <option value="0">Low (0)</option>
                                <option value="1">High (1)</option>
                            </select>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Post Question</button>
                </form>
            </div>
        `;
    } else {
        // User is not logged in
        authContent.innerHTML = `
            <div class="welcome-message">
                <p>Welcome to the Information Market Platform! Please <a href="/login">login</a> or <a href="/register">register</a> to start asking questions and providing answers.</p>
            </div>
        `;
    }
}

// Initialize auth content on page load
document.addEventListener('DOMContentLoaded', updateAuthContent);

// Update when auth state changes
window.addEventListener('storage', function(e) {
    if (e.key === 'auth_token') {
        updateAuthContent();
    }
});

// Cookie utility function
function getCookie(name) {
    const nameEQ = name + "=";
    const ca = document.cookie.split(';');
    for(let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) == ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
    }
    return null;
}
</script>
{% endblock %} 