{% extends "base.html" %}

{% block title %}{{ question.query or "Question" }} - Infonomy{% endblock %}

{% block content %}
<div class="container">
    <div class="question-detail">
        <div class="question-header">
            <h1 class="question-title">{{ question.query or "No title" }}</h1>
            <div class="question-meta">
                <span class="budget">Budget: ${{ "%.2f"|format(question.max_budget) }}</span>
                <span class="priority">Priority: {{ question.priority }}</span>
                <span class="date">{{ question.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
                <span class="author">by <a href="/users/{{ buyer.id }}">{{ buyer.username }}</a></span>
            </div>
            {% if question.context_pages %}
                <div class="context-pages">
                    <strong>Context:</strong> {{ question.context_pages|join(', ') }}
                </div>
            {% endif %}
        </div>
        
        {% if user and user.seller_profile %}
            <div class="new-answer-form">
                <h3>Provide an Answer</h3>
                <form method="post" action="/questions/{{ question.id }}/answers">
                    <div class="form-group">
                        <label for="private_info">Private Information:</label>
                        <textarea name="private_info" id="private_info" rows="4" placeholder="The detailed information you're offering..." required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="public_info">Public Information (optional):</label>
                        <textarea name="public_info" id="public_info" rows="2" placeholder="A brief preview of your information..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="price">Price:</label>
                        <input type="number" name="price" id="price" step="0.01" min="0" value="0.00" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Submit Answer</button>
                </form>
            </div>
        {% elif not user %}
            <div class="login-prompt">
                <p><a href="/login">Login</a> to provide answers to this question.</p>
            </div>
        {% endif %}
        
        <div class="answers-section">
            <h3>Answers ({{ info_offers|length }})</h3>
            
            {% if info_offers %}
                <div class="answers-list">
                    {% for answer in info_offers %}
                        <div class="answer-card" data-answer-id="{{ answer.id }}">
                            <div class="answer-header">
                                <span class="seller-info">
                                    {% if answer.human_seller_id %}
                                        <a href="/users/{{ answer.human_seller_id }}">Human Seller</a>
                                    {% else %}
                                        Bot Seller
                                    {% endif %}
                                </span>
                                <span class="price">${{ "%.2f"|format(answer.price) }}</span>
                                <span class="date">{{ answer.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
                            </div>
                            
                            {% if answer.public_info %}
                                <div class="public-info">
                                    {{ answer.public_info }}
                                </div>
                            {% endif %}
                            
                            <div class="private-info-section">
                                {% if is_question_owner %}
                                    <button class="btn btn-secondary inspect-btn" onclick="inspectAnswer({{ question.id }}, {{ answer.id }})">
                                        Inspect Answer
                                    </button>
                                    <div class="private-info hidden" id="private-info-{{ answer.id }}">
                                        <strong>Private Information:</strong>
                                        <div class="private-content">{{ answer.private_info }}</div>
                                    </div>
                                {% else %}
                                    <div class="private-info-placeholder">
                                        <em>Private information - only visible to question owner after inspection</em>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>No answers yet. Be the first to provide information!</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function inspectAnswer(questionId, answerId) {
    // This would integrate with your inspection API
    // For now, just show the private info
    const privateInfo = document.getElementById(`private-info-${answerId}`);
    if (privateInfo) {
        privateInfo.classList.remove('hidden');
    }
    
    // You could also make an API call here to trigger the inspection process
    // fetch(`/api/inspect/${questionId}/${answerId}`, { method: 'POST' })
}
</script>
{% endblock %} 